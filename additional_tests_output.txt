INFO:janus_agent.core.policy_repository:Loaded 1 policies from domain-finance.yaml
INFO:janus_agent.core.policy_repository:Loaded 1 policies from enterprise-security.yaml
INFO:janus_agent.core.policy_repository:Loaded 2 policies from agent-payment-processor.yaml
INFO:janus_agent.core.policy_repository:Loaded 4 policies from policies/examples
INFO:janus_agent.core.policy_repository:Loaded 1 policies from domain-finance.yaml
INFO:janus_agent.core.policy_repository:Loaded 1 policies from enterprise-security.yaml
INFO:janus_agent.core.policy_repository:Loaded 2 policies from agent-payment-processor.yaml
INFO:janus_agent.core.policy_repository:Loaded 4 policies from policies/examples

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ                                                                    â–ˆ
â–ˆ                       JANUS ADDITIONAL DEMO TESTS                  â–ˆ
â–ˆ                  Enterprise & Domain Policy Scenarios              â–ˆ
â–ˆ                                                                    â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

======================================================================
 ENTERPRISE POLICY TEST: PII Data Protection
======================================================================

    Policy Under Test:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  enterprise-pii-protection (Level: ENTERPRISE, Priority: 1)    â”‚
    â”‚  Action: data.export | Resource: external | Effect: DENY       â”‚
    â”‚  Condition: data_classification = "pii"                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
Scenario: Various agents attempting to export data externally

----------------------------------------------------------------------
Test: Export PII to external API
  Agent: data-export-agent
  Action: data.export â†’ external
  Data Classification: pii

  Policy Evaluation Chain:
    [DOMAIN    ] domain-finance-team-limit      â†’ â—‹ not applicable
    [ENTERPRISE] enterprise-pii-protection      â†’ âœ“ MATCHED
    [AGENT     ] agent-allow-small-payments     â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments      â†’ â—‹ not applicable

  âœ… Decision: DENY (policy: enterprise-pii-protection)
  Reason: Enterprise policy blocks ALL PII exports
----------------------------------------------------------------------
Test: Finance agent export PII
  Agent: finance-agent-1
  Action: data.export â†’ external
  Data Classification: pii

  Policy Evaluation Chain:
    [DOMAIN    ] domain-finance-team-limit      â†’ â—‹ not applicable
    [ENTERPRISE] enterprise-pii-protection      â†’ âœ“ MATCHED
    [AGENT     ] agent-allow-small-payments     â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments      â†’ â—‹ not applicable

  âœ… Decision: DENY (policy: enterprise-pii-protection)
  Reason: Even privileged finance agents cannot export PII
----------------------------------------------------------------------
Test: Export non-PII data externally
  Agent: data-export-agent
  Action: data.export â†’ external
  Data Classification: public

  Policy Evaluation Chain:
    [DOMAIN    ] domain-finance-team-limit      â†’ â—‹ not applicable
    [ENTERPRISE] enterprise-pii-protection      â†’ âœ“ MATCHED
    [AGENT     ] agent-allow-small-payments     â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments      â†’ â—‹ not applicable

  âœ… Decision: DENY (policy: enterprise-pii-protection)
  Reason: No explicit allow policy, defaults to deny
----------------------------------------------------------------------
Test: Export PII internally (not external)
  Agent: analytics-agent
  Action: data.export â†’ internal-warehouse
  Data Classification: pii

  Policy Evaluation Chain:
    [DOMAIN    ] domain-finance-team-limit      â†’ â—‹ not applicable
    [ENTERPRISE] enterprise-pii-protection      â†’ â—‹ not applicable
    [AGENT     ] agent-allow-small-payments     â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments      â†’ â—‹ not applicable

  âœ… Decision: DENY (policy: default-deny)
  Reason: Policy targets 'external' resource, but no allow exists
----------------------------------------------------------------------

ğŸ“Š Enterprise PII Tests: 4/4 passed

    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  KEY INSIGHT: Enterprise policies enforce organization-wide       â•‘
    â•‘  security rules that NO agent can bypass, regardless of their     â•‘
    â•‘  domain permissions or agent-level allowances.                    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    

======================================================================
 DOMAIN POLICY TEST: Finance Team Approval Workflow
======================================================================

    Policy Under Test:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  domain-finance-team-limit (Level: DOMAIN, Priority: 20)       â”‚
    â”‚  Action: payment.transfer | Subject: finance-*                 â”‚
    â”‚  Effect: REQUIRE_APPROVAL | Condition: amount >= $10,000       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Challenge: Agent-level policy denies ALL payments >= $1,000
    This test shows how policy hierarchy SHOULD work vs current behavior.
    
Scenario: Comparing regular vs finance agents on large transfers

----------------------------------------------------------------------
Test: Regular agent - $15,000 transfer
  Agent: payment-agent-1
  Amount: $15,000
  Context: Standard payment agent attempting large transfer

  Policy Evaluation (by hierarchy level):
    [ENTERPRISE] enterprise-pii-protection           â†’ â—‹ not applicable
    [DOMAIN    ] domain-finance-team-limit           â†’ â—‹ not applicable
    [AGENT     ] agent-allow-small-payments          â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments           â†’ âœ“ DENY

  âŒ Final Decision: DENY
     Winning Policy: agent-deny-large-payments
----------------------------------------------------------------------
Test: Finance agent - $15,000 transfer
  Agent: finance-agent-1
  Amount: $15,000
  Context: Finance team member with elevated permissions

  Policy Evaluation (by hierarchy level):
    [ENTERPRISE] enterprise-pii-protection           â†’ â—‹ not applicable
    [DOMAIN    ] domain-finance-team-limit           â†’ âœ“ REQUIRE_APPROVAL
    [AGENT     ] agent-allow-small-payments          â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments           â†’ â—‹ not applicable

  âš ï¸ Final Decision: REQUIRE_APPROVAL
     Winning Policy: domain-finance-team-limit
----------------------------------------------------------------------
Test: Finance agent - $5,000 transfer
  Agent: finance-agent-1
  Amount: $5,000
  Context: Finance agent below domain threshold

  Policy Evaluation (by hierarchy level):
    [ENTERPRISE] enterprise-pii-protection           â†’ â—‹ not applicable
    [DOMAIN    ] domain-finance-team-limit           â†’ â—‹ not applicable
    [AGENT     ] agent-allow-small-payments          â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments           â†’ â—‹ not applicable

  âŒ Final Decision: DENY
     Winning Policy: default-deny
----------------------------------------------------------------------
Test: Finance manager - $50,000 transfer
  Agent: finance-manager-1
  Amount: $50,000
  Context: Finance manager with large transaction

  Policy Evaluation (by hierarchy level):
    [ENTERPRISE] enterprise-pii-protection           â†’ â—‹ not applicable
    [DOMAIN    ] domain-finance-team-limit           â†’ âœ“ REQUIRE_APPROVAL
    [AGENT     ] agent-allow-small-payments          â†’ â—‹ not applicable
    [AGENT     ] agent-deny-large-payments           â†’ â—‹ not applicable

  âš ï¸ Final Decision: REQUIRE_APPROVAL
     Winning Policy: domain-finance-team-limit
----------------------------------------------------------------------

    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  ANALYSIS: Current PDP Behavior                                   â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘  The agent-level deny (amount >= $1000) currently catches all     â•‘
    â•‘  large payments before the domain require_approval can trigger.   â•‘
    â•‘                                                                   â•‘
    â•‘  This demonstrates an important design consideration:             â•‘
    â•‘  Effect precedence (deny > require_approval > allow) applies      â•‘
    â•‘  ACROSS all matching policies, not per-level.                     â•‘
    â•‘                                                                   â•‘
    â•‘  To enable domain override, you could:                            â•‘
    â•‘  1. Modify agent policy: subject="payment-*" (exclude finance)    â•‘
    â•‘  2. Adjust PDP: Apply effect precedence within each level first   â•‘
    â•‘  3. Use priority: Give domain policies lower (stronger) priority  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    

======================================================================
 HIERARCHY OVERRIDE DEMO: Domain Overrides Agent
======================================================================

    To properly demonstrate domain-level override, we simulate
    a policy configuration where:
    
    - Agent policy: Deny payments >= $1000 for "payment-*" agents only
    - Domain policy: Require approval for "finance-*" agents >= $10,000
    
    This allows finance agents to process mid-range payments ($1000-$9999)
    that regular payment agents cannot.
    

Modified Policy Configuration:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ agent-deny-large: subject='payment-*' (excludes finance-*)     â”‚
â”‚ domain-finance-elevated: allows finance-* up to $9,999         â”‚
â”‚ domain-finance-approval: requires approval for finance-* >=$10kâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

----------------------------------------------------------------------

Agent                         Amount Decision             Policy                        
=====================================================================================
payment-agent-1           $   5,000 âŒ deny              agent-deny-large              
finance-agent-1           $   5,000 âœ… allow             domain-finance-elevated       
finance-agent-1           $  15,000 âš ï¸ require_approval  domain-finance-approval       
finance-manager-1         $     500 âœ… allow             domain-finance-elevated       

=====================================================================================

    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  RESULT: With scoped agent policies, the hierarchy works:         â•‘
    â•‘                                                                   â•‘
    â•‘  â€¢ payment-agent-1 @ $5,000  â†’ DENY (agent-deny-large)           â•‘
    â•‘  â€¢ finance-agent-1 @ $5,000  â†’ ALLOW (domain-finance-elevated)   â•‘
    â•‘  â€¢ finance-agent-1 @ $15,000 â†’ REQUIRE_APPROVAL (domain policy)  â•‘
    â•‘                                                                   â•‘
    â•‘  Finance team gets elevated permissions via domain-level policy!  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    

======================================================================
 DEMO COMPLETE
======================================================================

    Summary of Policy Hierarchy Demonstration:
    
    1. ENTERPRISE LEVEL (Highest Priority)
       â””â”€ PII protection blocks ALL external data exports
       â””â”€ No agent or domain can override this
    
    2. DOMAIN LEVEL (Department Rules)  
       â””â”€ Can grant elevated permissions to specific agent groups
       â””â”€ Example: finance-* agents get higher transaction limits
    
    3. AGENT LEVEL (Service Rules)
       â””â”€ Default operational constraints
       â””â”€ Can be overridden by higher-level policies
    
    This demonstrates defense-in-depth with flexible policy management!
    
